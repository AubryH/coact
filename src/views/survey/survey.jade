extends ../header.jade
block head
  title Coact - Surveys
block vars
  - var nav = 'surveys'
block component
  .jumbotron
    .container
      .row
        .col-md-12
          h2= 'Formations with token : "' + token + '"'

  script(type='text/javascript').
    var questions = [];
  .survey(ng-controller='surveyFormCtrl')

    for question, indexQ in page.questions
      - var questionPath = 'questions[' + indexQ + ']'

      script(type='text/javascript').
        !{questionPath} = {
          label: !{JSON.stringify(question.label)},
          mark: !{JSON.stringify(question.mark)},
          comment: !{JSON.stringify(question.comment)}
        };

    .survey-page
      form(
        novalidate
        method="post"
        action="/survey/answer/" + token + "/" + pageNumber
        )
        .jumbotron
          .container
            .row
              .col-md-8
                h3= 'PAGE ' + pageNumber

                .page-content
                  .question(ng-repeat="question in questions")
                    h4= '{{question.label}}'
                    .container
                      .col-md-11.col-md-offset-1
                        .question-mark(ng-show="question.mark.allow")
                          .radio-mark(ng-repeat="mark in markRange")
                            input(
                              type="radio"
                              name="questions[{{$parent.$index}}]['mark']"
                              ng-model= 'question.mark.value'
                              value= '{{mark}}'
                            )
                            div {{mark}}
                        .question-comment(ng-show="question.comment.allow")
                          textarea(
                            rows=4
                            cols=70
                            name="questions[{{$index}}]['comment']"
                            ng-model= 'question.comment.text'
                            value= '{{question.comment.text}}'
                          )
            .row
              .col-md-8
                - for (var index = 1; index <= numberOfPages; index++)
                  .page-index(
                    class=index == pageNumber + 1 ? "current" : ""
                  )= index
                input.page-index.next-page(type='submit' value='Page suivante')
